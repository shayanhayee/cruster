# Knope configuration for cruster
# Uses changeset files for versioning and releases
# See: https://knope.tech

[package]
versioned_files = [
    "Cargo.toml",  # workspace version
    { path = "Cargo.lock", dependency = "cruster" },
]
changelog = "CHANGELOG.md"

[github]
owner = "mikearnaldi"
repo = "cruster"

# Workflow to prepare a release (creates/updates PR)
[[workflows]]
name = "prepare-release"

[[workflows.steps]]
type = "Command"
command = "git checkout -B release origin/main"

[[workflows.steps]]
type = "PrepareRelease"

[[workflows.steps]]
type = "Command"
command = "git add -A"

[[workflows.steps]]
type = "Command"
command = "git commit -m 'chore: prepare release $version'"

[[workflows.steps]]
type = "Command"
command = "git push --force --set-upstream origin release"

[[workflows.steps]]
type = "CreatePullRequest"
base = "main"

[workflows.steps.title]
template = "chore: prepare release $version"

[workflows.steps.body]
template = """
## Release $version

$changelog

---
*Merging this PR will publish to crates.io*
"""

# Workflow to create a release (runs after PR merge)
[[workflows]]
name = "release"

[[workflows.steps]]
type = "Release"
